## Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
## SPDX-License-Identifier: Apache-2.0

# This is a reusable workflow for running the Enablement test for App Signals.
# It is meant to be called from another workflow.
# Read more about reusable workflows: https://docs.github.com/en/actions/using-workflows/reusing-workflows#overview
name: Test
on:
  push:
    branches:
      - java-sigv4

permissions:
  id-token: write
  contents: read

jobs:
  # Runs in us-west-1 using us-east-1 account
  java-ec2-adot-sigv4:
    uses: ./.github/workflows/java-ec2-adot-sigv4-test.yml
    secrets: inherit
    with:
      caller-workflow-name: 'test'
      java-version: 11
      cpu-architecture: x86_64

  # publish-metric:
  #   needs: [ java-ec2-adot-sigv4 ]
  #   if: ${{ always() }}
  #   uses: ./.github/workflows/enablement-test-publish-result.yml
  #   secrets: inherit
  #   with:
  #     aws-region: ${{ inputs.aws-region }}
  #     caller-workflow-name: ${{ inputs.caller-workflow-name }}
  #     validation-result: ${{ needs.java-ec2-default-attempt-1.outputs.validation-result || needs.java-ec2-default-attempt-2.outputs.validation-result }}